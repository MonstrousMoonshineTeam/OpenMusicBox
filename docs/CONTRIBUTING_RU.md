# Соглашение о вкладе

*На данный момент документ служит целям налаживания командного взаимодействия, в нем могут содержаться ошибки или неактуальная информация. Впрочем, кому не пофиг?*

# Код стайл

*я сейчас в процессе конфигурирования линтера*

- Все публичные методы классов, публичные функции, а также публичные классы должны иметь docstrings[^1]. Их неплохо бы иметь и не публичным, но не обязательно
- Количество комментариев должно быть минимально возможным[^2]. Комментарии могут использоваться в следующих случаях:
    - Временно закомментированный код
    - TODO - оформляются как `#TODO: some text`. Следующую просьбу невозможно проконтролировать, поэтому она останется на вашей совести: если уж оставлять TODO'шки, то каждый член команды должен быть в состоянии их прочитать и понять
    - Пояснения относительно принятых реализационных решений (почему? как?). Комментарий пишется только если это НЕ ОЧЕВИДНО из самого кода, а сделать код более читаемым НЕ ПРЕДСТАВЛЯЕТСЯ ВОЗМОЖНЫМ
    - Управляющие комментарии (e.g. команды линтеру)

  Во всех остальных случаях ваш код должен быть достаточно читаем, чтобы это можно было понять и без комментариев

- Отступом считается 4 пробела
- Согласуемся с [PEP8](https://peps.python.org/pep-0008/) (лично мне VIM подсказывает когда я от него отхожу)
- Все, абсолютно все аргументы и параметры методов/функций должны иметь подсказки к типам. Даже если они выглядят страшно и длиной в километр, они должны быть
- В генериках (если они потребуются) пробелы внутри даймонд-операторов не ставим
- Если не хватает места в списке аргументов, делаем перенос строки и добавляем еще один уровень табуляции
- При разделении строк не дробим слова посередине. Желательно вообще дробить по смысловым частям когда это возможно. И напоминаю, что для питона 2 строки одна за другой без разделителей - это одна строка: `"hello " "world" == "hello world"`, даже если эти 2 куска на разных физических строках

# Рекомендации к коду

*Следовать не обязательно, но избавит от кучи головной боли*

- Читаем модуль [dataclasses](https://www.geeksforgeeks.org/understanding-python-dataclasses/) - куча оберток, которые помогут создавать типы данных не занимаясь написанием сотен сеттеров и геттеров
- Сначала читаем документацию, потом идем писать велосипед. (сам не следую, но вообще лучше провести 5 минут за чтением документации, чем 5 часов с дебаггером в руках)

# Ветки в проекте

Основная ветка - bard. (эквивалент у здоровых людей - master или main)

Ветка разработки - tavern. (эквивалент у здоровых людей - dev или development)

Коммитить в эти ветки напрямую не желательно. Обычно в командах создается pull request и его проверяет более опытный сотрудник. У нас более опытного сотрудника нет, поэтому в целом немного другое соглашение. Создавайте отдельные ветки под изменения (как это делать смотрите дальше), и создавайте PR если думаете, что вам могут помочь, а елси так не думаете, до делайте merge напрямую. Только обязательно добавляйте правильное сообщение к merge коммиту, чтобы если что было понятно, что отменять и с какого момента все упало

Веток может быть сколько угодно (и я даже рекомендую делать их много, хоть на каждый чих. В гите они почти ничего не весят). Любая ветка кроме описаных двух строится по следующему шаблону: `<branch-type>/branch-name`. Где branch-type - тип ветки - может быть одним из следующих:

- `feat` - добавление нового функционала в приложение
- `fix` - исправление ошибок и багов
- `hotfix` - (вряд ли нам потребуется, но на будущее) - когда в bard лежит уже что-то не то, пользователи жалуются, все горит, то создается эта ветка и чинит прод. После чего мерджится и с bard и с tavern
- `refactor` - "причесывание кода". Не факт, что руки дойдут, но тоже пусть будет
- `other` - все, что не относится к предыдущим 4. Например этот файлик пишется в other/contributing

branch-name указывается в кебаб-кейсе (`words-are-separated-with-dashes`). Он должен быть одновременно коротким и емким. В идеале каждый член команды должен быть способен понять, для чего эта ветка.

Пример ветки: `feat/playlist-subscription`

## Вложенные ветви

Как я уже и сказал, плодить в гите ветки можно хоть на каждый чих. И это в целом даже стоит делать по 2 причинам - чище код в плане коммитов и случайно не поломаешь код другого человека. Поэтому ветки вроде `feat/playlist-subscription/recolorize-buttons` вполне возможны. Ветвление может быть и дальше

И все же обычно оно не обязано быть таким сильным. Как правило оно появляется либо во время экспериментирования с какой-то веткой, либо когда над одной задачей работают несколько человек

Учтите, что пушить вообще все ветки на гитхаб совсем не обязательно. Лучше всего пушить только те, которые олицетворяют конкретные фичи, над которыми ведется работа

# Соглашение о коммитах

Все коммиты следуют [conventional commits](https://www.conventionalcommits.org/), при этом используются следующие типы:

- `feat` - добавлено что-то новое или разработка продвинулась дальше: `feat: added draggables to playlist`
- `fix` - исправления различного характера: `fix: fixed out of bounds on counter X`
- `chore` - изменение версий, подчистка комментариев, синхронизация изменений

Все коммиты должны быть сделаны на английском (вдруг все же кому-то захочится почитать нашу историю разработки. Не надо тут китайские шифры городить)

Также уточню, что в своих ветках делать с коммитами вы можете все что хотите, но в tavern и bard все должно быть  ними хорошо. Я к тому, что мы не делаем rebase на эти 2 ветки, мы не выкидываем из них коммиты и прочее. В рамках же своей ветки вы можете менять историю коммитов хоть 10 раз на день.

[^1]: Как правило в них описывается кратко что делает функция, а также подробнее поясняются аргументы функции. Иногда их используют для автогенерации документации
[^2]: Комментарии имеют неприятное свойство со временем становиться не актуальными. Поддерживать актуальность комментариев - дополнительная работа. Поскольку проект маленький, это возможно, но обычно в компаниях побольше от этого просто отказываются
